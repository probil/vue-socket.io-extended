function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){_defineProperty(e,t,r[t])})}return e}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}function _objectWithoutProperties(e,t){if(null==e)return{};var r,n,o=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function _toArray(e){return _arrayWithHoles(e)||_iterableToArray(e)||_nonIterableRest()}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}var isFunction=function(e){return"function"==typeof e},isSocketIo=function(e){return!!e&&isFunction(e.on)&&isFunction(e.emit)},unwrapIfSingle=function(e){return e&&e.length<=1?e[0]:e},pipe=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e){return t.reduce(function(e,t){return t(e)},e)}},prefixWith=function(e){return function(t){return e+t}},augmentMethod=function(e,t,r){var n=e[t];e[t]=function(){for(var t=arguments.length,o=new Array(t),i=0;i<t;i++)o[i]=arguments[i];n.call.apply(n,[e].concat(o)),r.apply(void 0,o)}},EventEmitter=function(){function e(){_classCallCheck(this,e),this.listeners=new Map}return _createClass(e,[{key:"addListener",value:function(e,t,r){isFunction(t)&&(this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push({callback:t,vm:r}))}},{key:"removeListener",value:function(e,t,r){if(isFunction(t)){var n=(this.listeners.get(e)||[]).filter(function(e){return e.callback!==t||e.vm!==r});n.length>0?this.listeners.set(e,n):this.listeners.delete(e)}}},{key:"emit",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];(this.listeners.get(e)||[]).forEach(function(e){var t;(t=e.callback).call.apply(t,[e.vm].concat(r))})}}]),e}(),GlobalEmitter=new EventEmitter,getRegisteredMutations=function(e){return Object.keys(e._mutations)},getRegisteredActions=function(e){return Object.keys(e._actions)},trimNamespace=function(e){return e.split("/").pop()};const preserveCamelCase=e=>{let t=!1,r=!1,n=!1;for(let o=0;o<e.length;o++){const i=e[o];t&&/[a-zA-Z]/.test(i)&&i.toUpperCase()===i?(e=e.slice(0,o)+"-"+e.slice(o),t=!1,n=r,r=!0,o++):r&&n&&/[a-zA-Z]/.test(i)&&i.toLowerCase()===i?(e=e.slice(0,o-1)+"-"+e.slice(o-1),n=r,r=!1,t=!0):(t=i.toLowerCase()===i,n=r,r=i.toUpperCase()===i)}return e};var camelcase=(e,t)=>{t=Object.assign({pascalCase:!1},t);const r=e=>t.pascalCase?e.charAt(0).toUpperCase()+e.slice(1):e;return 0===(e=Array.isArray(e)?e.map(e=>e.trim()).filter(e=>e.length).join("-"):e.trim()).length?"":1===e.length?t.pascalCase?e.toUpperCase():e.toLowerCase():/^[a-z\d]+$/.test(e)?r(e):(e!==e.toLowerCase()&&(e=preserveCamelCase(e)),r(e=e.replace(/^[_.\- ]+/,"").toLowerCase().replace(/[_.\- ]+(\w|$)/g,(e,t)=>t.toUpperCase())))},defaults=Object.freeze({actionPrefix:"socket_",mutationPrefix:"SOCKET_",eventToMutationTransformer:function(e){return e.toUpperCase()},eventToActionTransformer:camelcase}),SYSTEM_EVENTS=["connect","error","disconnect","reconnect","reconnect_attempt","reconnecting","reconnect_error","reconnect_failed","connect_error","connect_timeout","connecting","ping","pong"],Observe=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.store,n=_objectWithoutProperties(t,["store"]),o=_objectSpread({},defaults,n),i=pipe(o.eventToActionTransformer,prefixWith(o.actionPrefix)),a=pipe(o.eventToMutationTransformer,prefixWith(o.mutationPrefix));function c(e,t){if(r){var n=a(e),o=i(e),c=getRegisteredMutations(r),s=getRegisteredActions(r),u=unwrapIfSingle(t);c.filter(function(e){return trimNamespace(e)===n}).forEach(function(e){return r.commit(e,u)}),s.filter(function(e){return trimNamespace(e)===o}).forEach(function(e){return r.dispatch(e,u)})}}augmentMethod(e,"onevent",function(e){var t=_toArray(e.data),r=t[0],n=t.slice(1);GlobalEmitter.emit.apply(GlobalEmitter,[r].concat(_toConsumableArray(n))),c(r,n)}),SYSTEM_EVENTS.forEach(function(t){e.on(t,function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];GlobalEmitter.emit.apply(GlobalEmitter,[t].concat(r)),c(t,r)})})};function isNative(e){return"function"==typeof e&&/native code/.test(e.toString())}var hasProxy="undefined"!=typeof Proxy&&isNative(Proxy),createMixin=function(e){return{created:function(){var t=this,r=this.$options.sockets,n=void 0===r?{}:r;Object.keys(n).forEach(function(r){e.addListener(r,n[r],t)}),hasProxy&&(this.$options.sockets=new Proxy(n,{set:function(r,n,o){return e.addListener(n,o,t),r[n]=o,!0},deleteProperty:function(r,n){return e.removeListener(n,t.$options.sockets[n],t),delete r.key,!0}}))},beforeDestroy:function(){var t=this,r=this.$options.sockets,n=void 0===r?{}:r;Object.keys(n).forEach(function(r){hasProxy||e.removeListener(r,n[r],t),delete t.$options.sockets[r]})}}},Main={install:function(e,t,r){if(!isSocketIo(t))throw new Error("[vue-socket.io-ext] you have to pass `socket.io-client` instance to the plugin");Observe(t,r),e.prototype.$socket=t,e.mixin(createMixin(GlobalEmitter));var n=e.config.optionMergeStrategies;n.sockets=n.methods},defaults:defaults};export default Main;
